"use strict";(self.webpackChunkskeleton=self.webpackChunkskeleton||[]).push([[963],{5963:(L,D,l)=>{l.r(D),l.d(D,{default:()=>U});var u=l(6814),v=l(7818),x=l(9299),h=l(95),T=l(8193),p=l(5619),_=l(3185),t=l(9468),I=l(3946),y=l(4143),f=l(8672),A=l(220),E=l(4270);const M=["startDatePicker"],w=["endDatePicker"];function j(c,d){if(1&c){const a=t.EpF();t.TgZ(0,"div",17),t._uU(1),t.TgZ(2,"span",18),t.NdJ("click",function(){const s=t.CHM(a).$implicit,n=t.oxw();return t.KtG(n.removeVariableTag(s))}),t._UZ(3,"i",19),t.qZA()()}if(2&c){const a=d.$implicit,e=t.oxw();t.xp6(1),t.hij(" ",e.getTagValue(a)," ")}}function S(c,d){if(1&c){const a=t.EpF();t.TgZ(0,"div",17),t._uU(1),t.TgZ(2,"span",18),t.NdJ("click",function(){const s=t.CHM(a).$implicit,n=t.oxw();return t.KtG(n.removenAlogVariableIdsTag(s))}),t._UZ(3,"i",19),t.qZA()()}if(2&c){const a=d.$implicit,e=t.oxw();t.xp6(1),t.hij(" ",e.getAnalogTagValue(a)," ")}}function O(c,d){if(1&c){const a=t.EpF();t.TgZ(0,"div",17),t._uU(1),t.TgZ(2,"span",18),t.NdJ("click",function(){const s=t.CHM(a).$implicit,n=t.oxw();return t.KtG(n.removeAmbientVariableIdsTag(s))}),t._UZ(3,"i",19),t.qZA()()}if(2&c){const a=d.$implicit,e=t.oxw();t.xp6(1),t.hij(" ",e.getAmbientTagValue(a)," ")}}function V(c,d){if(1&c&&(t.TgZ(0,"option",26),t._uU(1),t.qZA()),2&c){const a=d.$implicit;t.Q6J("value",a.ChartId),t.xp6(1),t.hij("",a.ChartName," ")}}function P(c,d){if(1&c){const a=t.EpF();t.TgZ(0,"div",20)(1,"div",5)(2,"label"),t._uU(3,"Chart Type"),t.qZA()(),t.TgZ(4,"div",21)(5,"select",22),t.NdJ("ngModelChange",function(i){t.CHM(a);const s=t.oxw();return t.KtG(s.chartId=i)})("change",function(){t.CHM(a);const i=t.oxw();return t.KtG(i.changeChartType())}),t.YNc(6,V,2,2,"option",23),t.qZA()(),t.TgZ(7,"div",21)(8,"button",24),t.NdJ("click",function(){t.CHM(a);const i=t.oxw();return t.KtG(i.generateChart())}),t._UZ(9,"i",25),t._uU(10," Apply "),t.qZA()()()}if(2&c){const a=t.oxw();t.xp6(5),t.Q6J("ngModel",a.chartId),t.xp6(1),t.Q6J("ngForOf",a.chartList)}}const R=function(){return["admin"]},Z=function(){return{width:"100%",height:"180px"}};let U=(()=>{class c{constructor(a,e,i){this.modalService=a,this.dataAnalyticsService=e,this.spinner=i,this.toppings=new h.NI(""),this.toppingList=["Extra cheese","Mushroom","Onion","Pepperoni","Sausage","Tomato"],this.chartList=[],this.chartData={},this.width="600",this.height="400",this.dataFormat="json",this.showChart=!1,this.filterData={productId:"",testRunId:"",variableIds:[],IotPanelId:"",analogVariableIds:[],ambientVariableIds:[]},this.aodd=[],this.eodd=[],this.analogVariableList=[],this.ambientVariableList=[],this.items=[],this.tags=[],this.tagInputControl=new h.NI,this.projectChartDataStatus=new p.X(!1),this.analogChartDataStatus=new p.X(!1),this.ambientChartDataStatus=new p.X(!1)}removeVariableTag(a){this.filterData.variableIds=this.filterData.variableIds.filter(e=>e!==a)}removenAlogVariableIdsTag(a){this.filterData.analogVariableIds=this.filterData.analogVariableIds.filter(e=>e!==a)}removeAmbientVariableIdsTag(a){this.filterData.ambientVariableIds=this.filterData.ambientVariableIds.filter(e=>e!==a)}ngOnInit(){this.chartList=[{ChartId:"line",ChartName:"Trend"},{ChartId:"column",ChartName:"Bar"},{ChartId:"area",ChartName:"Area"},{ChartId:"scatter",ChartName:"Scatter"}],this.chartId=this.chartList[0].ChartId,this.type=this.chartId,this.dataSource={};const e=new Date,i=new Date;i.setMonth(i.getMonth()-1),this.endDate=e,this.startDate=i,this.startDate={year:this.startDate.getFullYear(),month:this.startDate.getMonth()+1,day:this.startDate.getDate()},this.endDate={year:this.endDate.getFullYear(),month:this.endDate.getMonth()+1,day:this.endDate.getDate()};const n=new Intl.DateTimeFormat("en-US",{hourCycle:"h24",year:"2-digit",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}),o=new Date;this.jsEndDate=o;const r=n.format(o),m=new Date;this.jsStartDate=m,m.setDate(m.getDate()-1);const g=n.format(m);this.formattedDateTimeRange=g+" - "+r,this.projectChartDataStatus.subscribe(()=>{this.projectChartDataStatus.value&&this.analogChartDataStatus.value&&this.ambientChartDataStatus.value&&(this.changeChart(),this.changeChart())}),this.analogChartDataStatus.subscribe(()=>{this.projectChartDataStatus.value&&this.analogChartDataStatus.value&&this.ambientChartDataStatus.value&&(this.changeChart(),this.changeChart())}),this.ambientChartDataStatus.subscribe(()=>{this.projectChartDataStatus.value&&this.analogChartDataStatus.value&&this.ambientChartDataStatus.value&&(this.changeChart(),this.changeChart())})}getTagValue(a){let e;return e="EODD"==this.projectType?this.eodd.find(i=>i.id==a):this.aodd.find(i=>i.id==a),e?.name}getAnalogTagValue(a){return this.analogVariableList.find(e=>e.VariableId==a)?.VariableName}getAmbientTagValue(a){return this.ambientVariableList.find(e=>e.VariableId==a)?.VariableName}onDropDownClose(){console.log("dropdown closed")}onItemSelect(a){console.log(a)}onSelectAll(a){console.log(a)}openModal(){const i={startDate:this.jsStartDate,endDate:this.jsEndDate,filterData:this.filterData,projectType:this.projectType},s=this.modalService.open(x.Z,{size:"lg"});s.componentInstance.inputData=i,s.result.then(n=>{console.log(n),1==n.isSearch&&(this.filterData=n.filterData,this.ambientVariableData=n.ambientVariableData,console.log(this.filterData),this.filterData.analogVariableIds.forEach(o=>{const r=o;this.tags.includes(r)||this.tags.push(r)}),this.filterData.variableIds.forEach(o=>{const r=o;this.tags.includes(r)||this.tags.push(r)}),this.filterData.ambientVariableIds.forEach(o=>{const r=o;null!=r&&null!=r&&(this.tags.includes(r)||this.tags.push(r))}),this.aodd=n.aodd,this.eodd=n.eodd,this.projectType=n.projectType,this.analogVariableList=n.analogVariableList,this.ambientVariableList=n.ambientVariableList)},n=>{console.log(`Modal dismissed with: ${n}`)})}openDateTimeModal(){const i={startDate:this.jsStartDate,endDate:this.jsEndDate},s=this.modalService.open(T.Z);s.componentInstance.inputData=i,s.result.then(n=>{const r=new Intl.DateTimeFormat("en-US",{hourCycle:"h24",year:"2-digit",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}),m=new Date(n.dateData.startDate.year,n.dateData.startDate.month-1,n.dateData.startDate.day,n.dateData.startTime.hour,n.dateData.startTime.minute,0),g=r.format(m),b=new Date(n.dateData.endDate.year,n.dateData.endDate.month-1,n.dateData.endDate.day,n.dateData.endTime.hour,n.dateData.endTime.minute,0),C=r.format(b);console.log(g+" - "+C),this.formattedDateTimeRange=g+" - "+C,this.jsStartDate=m,this.jsEndDate=b},n=>{console.log(`Modal dismissed with: ${n}`)})}generateChart(){this.showChart=!1,this.spinner.show();const a=this.filterData,e=this.jsStartDate,i=this.jsEndDate;console.log(e,i);let s={};if(""==a.productId&&0==a.variableIds.length)s={start:e,end:i};else if(""==a.productId&&a.variableIds.length>0)s={start:e,end:i,Data:a.variableIds};else if(""!=a.productId&&0==a.variableIds.length)s={start:e,end:i,id:a.productId,no:a.testRunId};else if(""!=a.productId&&a.variableIds.length>0){s={start:e,end:i,id:a.productId,no:parseInt(a.testRunId),Data:a.variableIds};const n=a.variableIds.map(o=>`\`${o}\``);s.Data=n}if(a.productId&&a.variableIds.length?this.dataAnalyticsService.getProjectSectionChartData(s).subscribe({next:n=>{console.log(n),this.projectChartRawData=n,this.projectChartDataStatus.next(!0)},error:n=>{console.log(n)}}):this.projectChartDataStatus.next(!0),this.filterData.analogVariableIds.length){const n={start:e,end:i};if(a.analogVariableIds.length>0){const o=a.analogVariableIds.map(r=>`${r}`);n.Data=o}this.dataAnalyticsService.getAnalogSectionChartData(n).subscribe({next:o=>{console.log(o),this.analogChartRawData=o,this.analogChartDataStatus.next(!0)},error:o=>{console.log(o)}})}else this.analogChartDataStatus.next(!0);if(a.ambientVariableIds.length&&!this.filterData.variableIds.length){const n={start:e,end:i};if(a.ambientVariableIds.length>0){const o=a.ambientVariableIds.map(r=>`\`${r}\``);n.Data=o}this.dataAnalyticsService.getAmbientSectionChartData(n).subscribe({next:o=>{console.log(o),this.ambientChartRawData=o,this.ambientChartDataStatus.next(!0)},error:o=>{console.log(o)}})}else this.ambientChartDataStatus.next(!0)}changeChartType(){}changeChart(){const a={chart:{caption:"",yaxisname:"",subcaption:"",showhovereffect:"1",numbersuffix:"",drawcrossline:"",plottooltext:"",theme:"fusion"},xAxis:{outputTimeFormat:{hour:"%H:%M:%S",minute:"%H:%M:%S",second:"%H:%M:%S"}},categories:[{category:[]}],dataset:[],dataLabels:{enabled:!1}};if(Array.isArray(this.projectChartRawData)&&this.filterData.variableIds.length&&this.projectChartRawData.length>0&&(console.log(this.projectChartRawData),this.projectChartRawData.forEach(e=>{a.categories[0].category.push({label:e.datetime})}),this.filterData.variableIds.forEach(e=>{const i=e,s=[];this.projectChartRawData.forEach(o=>{const r={x:new Date(o.datetime),y:o[e]};s.push(r)}),a.dataset.push({name:i,type:this.chartId,showInLegend:!0,dataPoints:s,visible:1})}),this.filterData.ambientVariableIds.length&&this.filterData.ambientVariableIds.forEach(e=>{const i=e,s=[];this.projectChartRawData.forEach(o=>{const r={x:new Date(o.datetime),y:o[e]};s.push(r)}),a.dataset.push({name:i,type:this.chartId,showInLegend:!0,dataPoints:s,visible:1})})),this.analogChartRawData&&this.analogChartRawData.length){const i=[];Object.keys(this.analogChartRawData[0]).map(s=>{"DateTime"!=s&&i.push({name:s,type:this.chartId,showInLegend:!0,dataPoints:[],visible:1})}),this.analogChartRawData.map(s=>{Object.keys(s).map(n=>{const o=i.find(r=>r.name==n);o&&o.dataPoints.push({x:new Date(s.DateTime),y:s[n]})})}),i.map(s=>{a.dataset.push(s),console.log(s)})}this.filterData.ambientVariableIds.length&&!this.filterData.variableIds.length&&this.ambientChartRawData.length>0&&(console.log(this.ambientChartRawData),this.filterData.ambientVariableIds.forEach(e=>{const i=e,s=[];this.ambientChartRawData.forEach(o=>{const r={x:new Date(o.DateTime),y:o[e]};s.push(r)}),a.dataset.push({name:i,type:this.chartId,showInLegend:!0,dataPoints:s,visible:1})})),this.type=this.chartId,this.dataSource=a,this.chartOptions={zoomEnabled:!0,animationEnabled:!0,theme:"light2",title:{text:""},axisX:{valueFormatString:"DD/MM/YYYY HH:mm:ss"},axisY:{title:"Value",suffix:""},data:a.dataset},this.spinner.hide(),this.showChart=!0}static#t=this.\u0275fac=function(e){return new(e||c)(t.Y36(I.FF),t.Y36(y._),t.Y36(f.t2))};static#a=this.\u0275cmp=t.Xpm({type:c,selectors:[["app-data-analytics-time"]],viewQuery:function(e,i){if(1&e&&(t.Gf(M,5),t.Gf(w,5)),2&e){let s;t.iGM(s=t.CRH())&&(i.startDatePicker=s.first),t.iGM(s=t.CRH())&&(i.endDatePicker=s.first)}},standalone:!0,features:[t.jDz],decls:27,vars:11,consts:[["type","ball-scale-multiple"],[1,"row","btn-page"],[1,"col-sm-12"],[1,"custom-card",3,"customHeader"],[1,"form-group","row"],[1,"col-md-3"],[1,"col-md-9"],[1,"custom-datetime-range-span",3,"click"],[1,"fas","fa-calendar"],[1,"col-md-9","disp-flex"],["type","button","ngbAutofocus","",1,"btn","btn-outline-secondary","tag-btn",3,"click"],[1,"fas","fa-plus"],[1,"tag-input"],["class","tag",4,"ngFor","ngForOf"],["class","form-group row align-items-center",4,"appHasRoles"],["cardTitle","Basic",3,"hidden"],["id","chartContainer",3,"options","styles"],[1,"tag"],[1,"remove",3,"click"],[1,"fas","fa-times"],[1,"form-group","row","align-items-center"],[1,"col-md-2"],[1,"form-control",3,"ngModel","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],["type","button","ngbAutofocus","",1,"btn","btn-block","btn-primary","btn-apply","mb-4","custom-btn",3,"click"],[1,"fas","fa-check"],[3,"value"]],template:function(e,i){1&e&&(t._UZ(0,"ngx-spinner",0),t.TgZ(1,"div",1)(2,"div",2)(3,"app-card",3)(4,"div",4)(5,"div",5)(6,"label"),t._uU(7,"Data Source & Analysis Tool"),t.qZA()(),t.TgZ(8,"div",6)(9,"span",7),t.NdJ("click",function(){return i.openDateTimeModal()}),t._UZ(10,"i",8),t._uU(11),t.qZA()()(),t.TgZ(12,"div",4)(13,"div",5)(14,"label"),t._uU(15,"Selected Tags"),t.qZA()(),t.TgZ(16,"div",9)(17,"button",10),t.NdJ("click",function(){return i.openModal()}),t._uU(18," Add Tags "),t._UZ(19,"i",11),t.qZA(),t.TgZ(20,"div",12),t.YNc(21,j,4,1,"div",13),t.YNc(22,S,4,1,"div",13),t.YNc(23,O,4,1,"div",13),t.qZA()()(),t.YNc(24,P,11,2,"div",14),t.qZA(),t.TgZ(25,"app-card",15),t._UZ(26,"canvasjs-chart",16),t.qZA()()()),2&e&&(t.xp6(3),t.Q6J("customHeader",!0),t.xp6(8),t.hij(" ",i.formattedDateTimeRange," "),t.xp6(10),t.Q6J("ngForOf",i.filterData.variableIds),t.xp6(1),t.Q6J("ngForOf",i.filterData.analogVariableIds),t.xp6(1),t.Q6J("ngForOf",i.filterData.ambientVariableIds),t.xp6(1),t.Q6J("appHasRoles",t.DdM(9,R)),t.xp6(1),t.Q6J("hidden",!i.showChart),t.xp6(1),t.Q6J("options",i.chartOptions)("styles",t.DdM(10,Z)))},dependencies:[u.ez,u.sg,v.m,h.YN,h.Kr,h.EJ,h.JJ,h.On,A.A,E.c,f.Ro,_.n,_.x],styles:[".bi-calendar3{margin-bottom:0}  .btn-apply{padding:2px 8px!important;margin-left:5px}  .custom-card .card{background:linear-gradient(to bottom,rgba(0,190,219,.1490196078),rgba(12,255,0,.1490196078))!important}  .custom-card .card .card-header h5,   .custom-card .card .card-header .h5{font-weight:400;font-size:12px}  .custom-card .input-group.dp .form-control{background:transparent;margin-bottom:5px;padding:0 15px;font-size:14px;line-height:.5;height:25px}  .custom-card .input-group.dp .bi-calendar3.btn{padding-bottom:0!important;padding-top:0!important}  .custom-card select.form-control{background-color:#f5f5f5;line-height:15px}  .custom-card .card .card-header{padding:10px 25px}  .custom-card .card .card-body{padding:10px 25px}  .custom-card .card .card-header .card-header-right .btn.dropdown-toggle{display:none}  .custom-card .form-group label{font-weight:400}  .custom-card .form-control{font-size:14px;line-height:1}  .custom-btn.btn{border-radius:20px;margin:5px!important}  .tag-btn{border-radius:20px;margin-bottom:5px!important;font-size:10px;padding-left:5px;padding-right:5px;margin-right:0!important;margin-top:4px}.card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .card-header-right[_ngcontent-%COMP%]   .btn.dropdown-toggle[_ngcontent-%COMP%]{display:none}.tag-input[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;margin:0}.tag[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff;padding:6px 8px;margin:0 4px;display:flex;align-items:center;border-radius:20px;font-size:10px}.remove[_ngcontent-%COMP%]{cursor:pointer;margin-left:4px;font-weight:700}.disp-flex[_ngcontent-%COMP%]{display:flex}.custom-datetime-range-span[_ngcontent-%COMP%]{padding:2px 8px;border:solid 1px rgb(206,212,218);border-radius:20px}.custom-datetime-range-span[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:15px}"]})}return c})()}}]);