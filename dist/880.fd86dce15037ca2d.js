"use strict";(self.webpackChunkskeleton=self.webpackChunkskeleton||[]).push([[880],{6880:(O,D,h)=>{h.r(D),h.d(D,{default:()=>N});var f=h(6814);const x={chart:{aligncaptionwithcanvas:"0",plottooltext:"<b>$dataValue</b> leads received",theme:"fusion"},data:[{value:"41"},{value:"39"},{value:"38"},{value:"32"},{value:"26"},{value:"25"},{value:"25"},{value:"24"},{value:"23"},{value:"22"},{value:"18"},{value:"16"},{value:"15"},{value:"13"},{value:"12"},{value:"11"},{value:"10"},{value:"6"},{value:"4"},{value:"1"},{value:"1"},{value:"1"},{value:"1"}]},C={chart:{lineThickness:"3",lineColor:"#000000",theme:"fusion"},data:[{value:"5.6"},{value:"8.8"},{value:"9.3"},{value:"2"},{value:"5.6"},{value:"0.5"},{value:"9.1"}],trendlines:[{line:[{startvalue:"5.7",color:"#E40303",valueOnRight:"1",thickness:"3"}]}]};var y=h(7818),b=h(8351),_=h(8193),u=h(95),I=h(9299),t=h(9468),T=h(3946),A=h(4143),v=h(8672),V=h(220),w=h(4270);function Z(d,g){if(1&d&&(t.TgZ(0,"option",23),t._uU(1),t.qZA()),2&d){const a=g.$implicit;t.Q6J("value",g.index),t.xp6(1),t.hij("",a.ChartName," ")}}function S(d,g){if(1&d){const a=t.EpF();t.TgZ(0,"input",24),t.NdJ("ngModelChange",function(i){t.CHM(a);const r=t.oxw(2);return t.KtG(r.binWidth=i)}),t.qZA()}if(2&d){const a=t.oxw(2);t.Q6J("ngModel",a.binWidth)("disabled",!a.binWidth)}}function j(d,g){if(1&d){const a=t.EpF();t.TgZ(0,"div",18)(1,"div",3)(2,"label"),t._uU(3,"Chart Type"),t.qZA()(),t.TgZ(4,"div",19)(5,"select",20),t.NdJ("ngModelChange",function(i){t.CHM(a);const r=t.oxw();return t.KtG(r.chartId=i)}),t.YNc(6,Z,2,2,"option",21),t.qZA(),t.YNc(7,S,1,2,"input",22),t.qZA()()}if(2&d){const a=t.oxw();t.xp6(5),t.Q6J("ngModel",a.chartId),t.xp6(1),t.Q6J("ngForOf",a.chartList),t.xp6(1),t.Q6J("ngIf","3"===a.chartId)}}function M(d,g){if(1&d){const a=t.EpF();t.TgZ(0,"div",25),t._uU(1),t.TgZ(2,"span",26),t.NdJ("click",function(){const r=t.CHM(a).$implicit,e=t.oxw();return t.KtG(e.removeVariableTag(r))}),t._UZ(3,"i",27),t.qZA()()}if(2&d){const a=g.$implicit,n=t.oxw();t.xp6(1),t.hij(" ",n.getTagValue(a)," ")}}function R(d,g){if(1&d){const a=t.EpF();t.TgZ(0,"div",25),t._uU(1),t.TgZ(2,"span",26),t.NdJ("click",function(){const r=t.CHM(a).$implicit,e=t.oxw();return t.KtG(e.removenAlogVariableIdsTag(r))}),t._UZ(3,"i",27),t.qZA()()}if(2&d){const a=g.$implicit,n=t.oxw();t.xp6(1),t.hij(" ",n.getAnalogTagValue(a)," ")}}function E(d,g){if(1&d){const a=t.EpF();t.TgZ(0,"div",25),t._uU(1),t.TgZ(2,"span",26),t.NdJ("click",function(){const r=t.CHM(a).$implicit,e=t.oxw();return t.KtG(e.removeAmbientVariableIdsTag(r))}),t._UZ(3,"i",27),t.qZA()()}if(2&d){const a=g.$implicit,n=t.oxw();t.xp6(1),t.hij(" ",n.getAmbientTagValue(a)," ")}}function F(d,g){if(1&d&&(t.TgZ(0,"app-card",28)(1,"div",29)(2,"div",30)(3,"span"),t._uU(4,"Mean: 5"),t.qZA(),t.TgZ(5,"span"),t._uU(6,"Median: 6"),t.qZA(),t.TgZ(7,"span"),t._uU(8,"Mode: 2"),t.qZA(),t.TgZ(9,"span"),t._uU(10,"1st Quartile Range: 2.253"),t.qZA(),t.TgZ(11,"span"),t._uU(12,"2nd Quartile Range: 3.253"),t.qZA(),t.TgZ(13,"span"),t._uU(14,"3rd Quartile Range: 4.253"),t.qZA()()(),t._UZ(15,"fusioncharts",31),t.qZA()),2&d){const a=t.oxw();t.Q6J("options",!1)("customDate",!0),t.xp6(15),t.Q6J("height",a.height)("type",a.type)("dataFormat",a.dataFormat)("dataSource",a.dataSource)}}const L=function(){return["admin"]};let N=(()=>{class d{constructor(a,n,i){this.modalService=a,this.dataAnalyticsService=n,this.spinner=i,this.width="600",this.height="400",this.barType="bar2d",this.lineType="line",this.dataFormat="json",this.barDataSource=x,this.lineDataSource=C,this.lineClass="col",this.labels="",this.type="",this.filterData={productId:"",testRunId:"",variableIds:[],IotPanelId:"",analogVariableIds:[],ambientVariableIds:[]},this.aodd=[],this.eodd=[],this.analogVariableList=[],this.ambientVariableList=[],this.items=[],this.tags=[],this.tagInputControl=new u.NI,this.showChart=!1,this.chartList=[]}ngOnInit(){this.chartList=[{ChartId:"spline",ChartName:"Correlation"},{ChartId:"column2d",ChartName:"Standard Deviation"},{ChartId:"scatter",ChartName:"Linear Regression"},{ChartId:"column2d",ChartName:"Histogram Analysis"}],this.chartId=0,this.type=this.chartList[this.chartId].ChartId;const n=new Date,i=new Date;i.setMonth(i.getMonth()-1),this.endDate=n,this.startDate=i,this.startDate={year:this.startDate.getFullYear(),month:this.startDate.getMonth()+1,day:this.startDate.getDate()},this.endDate={year:this.endDate.getFullYear(),month:this.endDate.getMonth()+1,day:this.endDate.getDate()};const e=new Intl.DateTimeFormat("en-US",{hourCycle:"h24",year:"2-digit",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}),s=new Date;this.jsEndDate=s;const l=e.format(s),o=new Date;this.jsStartDate=o,o.setDate(o.getDate()-1);const c=e.format(o);this.formattedDateTimeRange=c+" - "+l}getTagValue(a){let n;return n="EODD"==this.projectType?this.eodd.find(i=>i.id==a):this.aodd.find(i=>i.id==a),n?.name}getAnalogTagValue(a){return this.analogVariableList.find(n=>n.VariableId==a)?.VariableName}getAmbientTagValue(a){return this.ambientVariableList.find(n=>n.VariableId==a)?.VariableName}removeVariableTag(a){this.filterData.variableIds=this.filterData.variableIds.filter(n=>n!==a)}removenAlogVariableIdsTag(a){this.filterData.analogVariableIds=this.filterData.analogVariableIds.filter(n=>n!==a)}removeAmbientVariableIdsTag(a){this.filterData.ambientVariableIds=this.filterData.ambientVariableIds.filter(n=>n!==a)}openDateTimeModal(){const i={startDate:this.jsStartDate,endDate:this.jsEndDate},r=this.modalService.open(_.Z);r.componentInstance.inputData=i,r.result.then(e=>{const l=new Intl.DateTimeFormat("en-US",{hourCycle:"h24",year:"2-digit",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}),o=new Date(e.dateData.startDate.year,e.dateData.startDate.month-1,e.dateData.startDate.day,e.dateData.startTime.hour,e.dateData.startTime.minute,0),c=l.format(o),p=new Date(e.dateData.endDate.year,e.dateData.endDate.month-1,e.dateData.endDate.day,e.dateData.endTime.hour,e.dateData.endTime.minute,0),m=l.format(p);console.log(c+" - "+m),this.formattedDateTimeRange=c+" - "+m,this.jsStartDate=o,this.jsEndDate=p},e=>{console.log(`Modal dismissed with: ${e}`)})}openModal(){const r={startDate:this.jsStartDate,endDate:this.jsEndDate,filterData:this.filterData,projectType:this.projectType,name:this.chartList[this.chartId].ChartName},e=this.modalService.open(I.Z,{size:"lg"});e.componentInstance.inputData=r,e.result.then(s=>{console.log(s),1==s.isSearch&&(this.filterData=s.filterData,this.ambientVariableData=s.ambientVariableData,console.log(this.filterData),this.filterData.analogVariableIds.forEach(l=>{const o=l;this.tags.includes(o)||this.tags.push(o)}),this.filterData.variableIds.forEach(l=>{const o=l;this.tags.includes(o)||this.tags.push(o)}),this.filterData.ambientVariableIds.forEach(l=>{const o=l;null!=o&&null!=o&&(this.tags.includes(o)||this.tags.push(o))}),this.aodd=s.aodd,this.eodd=s.eodd,this.projectType=s.projectType,this.analogVariableList=s.analogVariableList,this.ambientVariableList=s.ambientVariableList)},s=>{console.log(`Modal dismissed with: ${s}`)})}changeChart(){const a=this.chartList[this.chartId].ChartName;if("Linear Regression"===a){let n=1;const i={chart:{caption:"",yaxisname:"",subcaption:"",showhovereffect:"1",numbersuffix:"",drawcrossline:"",plottooltext:"",theme:"fusion"},dataset:[],dataLabels:{enabled:!1}};if(Array.isArray(this.projectChartRawData)&&this.projectChartRawData.length>0&&this.filterData.variableIds.forEach(r=>{const e=[];this.projectChartRawData.forEach(l=>{const o={x:n++,y:l[r]};e.push(o)}),i.dataset.push({showRegressionLine:"1",data:e})}),this.analogChartRawData){const r=this.analogChartRawData.filter(s=>this.filterData.analogVariableIds.includes(s.data)),e=[];r.forEach(s=>{const l=s.data;let o=e.find(c=>c.data===l);o||(o={data:l,values:[]},e.push(o)),o.values.push({Value:s.Value,DateTime:s.DateTime})}),r.length>0&&e[0].values.length>0&&e.forEach(s=>{const l=[];s.values.forEach(c=>{const p={x:n++,y:c.Value};l.push(p)}),i.dataset.push({showRegressionLine:"1",data:l})})}this.ambientChartRawData&&this.ambientChartRawData.length>0&&this.filterData.ambientVariableIds.forEach(r=>{const e=[];this.ambientChartRawData.forEach(l=>{const o={x:n++,y:l[r]};e.push(o)}),i.dataset.push({showRegressionLine:"1",data:e})}),console.log(i),this.type=this.chartList[this.chartId].ChartId,console.log(this.type),this.dataSource=i}else if("Histogram Analysis"==a){const n={chart:{caption:"",yaxisname:"",subcaption:"",showhovereffect:"1",numbersuffix:"",drawcrossline:"",plottooltext:"",theme:"fusion"},data:[],dataLabels:{enabled:!1}},i=[];if(this.filterData.variableIds.length&&Array.isArray(this.projectChartRawData))this.filterData.variableIds.forEach(l=>{this.projectChartRawData.forEach(o=>{i.push(o[l])})});else if(this.filterData.analogVariableIds.length&&this.analogChartRawData){const l=this.analogChartRawData.filter(c=>this.filterData.analogVariableIds.includes(c.data)),o=[];l.forEach(c=>{const p=c.data;let m=o.find(U=>U.data===p);m||(m={data:p,values:[]},o.push(m)),m.values.push({Value:c.Value,DateTime:c.DateTime})}),l.length>0&&o[0].values.length>0&&o.forEach(c=>{c.values.forEach(p=>{i.push(p.Value)})})}else if(this.filterData.ambientVariableIds.length&&this.ambientChartRawData&&this.ambientChartRawData.length>0){const l=[];this.filterData.ambientVariableIds.forEach(o=>{this.ambientChartRawData.forEach(c=>{l.push(c[o])})})}i.sort();let e,r=10;this.binWidth?(r=(i[i.length-1]-i[0])/+this.binWidth,e=+this.binWidth):(e=(i[i.length-1]-i[0])/r,this.binWidth=e),console.log(e);let s=0;for(let l=1;l<=r;l++){const c=s+e;n.data.push({label:`[${s} - ${c}]`,value:this.countInRange(i,s,c)}),s=c}this.type=this.chartList[this.chartId].ChartId,this.dataSource=n}this.showChart=!0,this.spinner.hide()}generateChart(){this.showChart=!1,this.spinner.show();const a=this.filterData;console.log(this.startDate,this.endDate);const n=new Date(this.startDate.year,this.startDate.month-1,this.startDate.day),i=new Date(this.endDate.year,this.endDate.month-1,this.endDate.day);let r={};if(""==a.productId&&0==a.variableIds.length)r={start:n,end:i};else if(""==a.productId&&a.variableIds.length>0)r={start:n,end:i,Data:a.variableIds};else if(""!=a.productId&&0==a.variableIds.length)r={start:n,end:i,id:a.productId,no:a.testRunId};else if(""!=a.productId&&a.variableIds.length>0){r={start:n,end:i,id:a.productId,no:parseInt(a.testRunId),Data:a.variableIds};const e=a.variableIds.map(s=>`\`${s}\``);r.Data=e}if("2"==this.chartId||"3"==this.chartId)if(this.filterData.variableIds.length)this.dataAnalyticsService.getProjectSectionChartData(r).subscribe({next:e=>{console.log(e),this.projectChartRawData=e,this.changeChart()},error:e=>{console.log(e)}});else if(this.filterData.analogVariableIds.length){const e={start:n,end:i};if(a.analogVariableIds.length>0){const s=a.analogVariableIds.map(l=>`\`${l}\``);e.Data=s}this.dataAnalyticsService.getAnalogSectionChartData(e).subscribe({next:s=>{console.log(s),this.analogChartRawData=s,this.changeChart()},error:s=>{console.log(s)}})}else if(this.filterData.ambientVariableIds.length){const e={start:n,end:i};if(a.ambientVariableIds.length>0){const s=a.ambientVariableIds.map(l=>`\`${l}\``);e.Data=s}this.dataAnalyticsService.getAmbientSectionChartData(e).subscribe({next:s=>{console.log(s),this.ambientChartRawData=s,this.changeChart()},error:s=>{console.log(s)}})}}countInRange(a,n,i){let r=0;for(const e of a)e>=n&&e<i&&r++;return r}static#t=this.\u0275fac=function(n){return new(n||d)(t.Y36(T.FF),t.Y36(A._),t.Y36(v.t2))};static#a=this.\u0275cmp=t.Xpm({type:d,selectors:[["app-data-analytics-state"]],standalone:!0,features:[t.jDz],decls:30,vars:8,consts:[["type","ball-scale-multiple"],[1,"custom-card",3,"customHeader"],[1,"form-group","row"],[1,"col-md-3"],[1,"col-md-9"],[1,"custom-datetime-range-span",3,"click"],[1,"fas","fa-calendar"],["class","form-group row align-items-center",4,"appHasRoles"],[1,"col-md-9","disp-flex"],["type","button","ngbAutofocus","",1,"btn","btn-outline-secondary","tag-btn",3,"click"],[1,"fas","fa-plus"],[1,"tag-input"],["class","tag",4,"ngFor","ngForOf"],[1,"row"],[1,"col-md-12"],["type","button","ngbAutofocus","",1,"btn","btn-block","btn-primary","mb-4","custom-btn","btn-apply",3,"click"],[1,"fas","fa-check"],["cardTitle","Trend","blockClass","d-flex",3,"options","customDate",4,"ngIf"],[1,"form-group","row","align-items-center"],[1,"col-md-3","d-flex","gap-2"],[1,"form-control",2,"flex","0.7",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["type","text","class","form-control","style","flex:0.3;",3,"ngModel","disabled","ngModelChange",4,"ngIf"],[3,"value"],["type","text",1,"form-control",2,"flex","0.3",3,"ngModel","disabled","ngModelChange"],[1,"tag"],[1,"remove",3,"click"],[1,"fas","fa-times"],["cardTitle","Trend","blockClass","d-flex",3,"options","customDate"],[1,"app-card-subheader","d-flex","justify-content-between"],[1,"d-flex","gap-3"],["width","100%",3,"height","type","dataFormat","dataSource"]],template:function(n,i){1&n&&(t._UZ(0,"ngx-spinner",0),t.TgZ(1,"div")(2,"app-card",1)(3,"div",2)(4,"div",3)(5,"label"),t._uU(6,"Data Source & Analysis Tool"),t.qZA()(),t.TgZ(7,"div",4)(8,"span",5),t.NdJ("click",function(){return i.openDateTimeModal()}),t._UZ(9,"i",6),t._uU(10),t.qZA()()(),t.YNc(11,j,8,3,"div",7),t.TgZ(12,"div",2)(13,"div",3)(14,"label"),t._uU(15,"Selected Tags"),t.qZA()(),t.TgZ(16,"div",8)(17,"button",9),t.NdJ("click",function(){return i.openModal()}),t._uU(18," Add Tags "),t._UZ(19,"i",10),t.qZA(),t.TgZ(20,"div",11),t.YNc(21,M,4,1,"div",12),t.YNc(22,R,4,1,"div",12),t.YNc(23,E,4,1,"div",12),t.qZA()()(),t.TgZ(24,"div",13)(25,"div",14)(26,"button",15),t.NdJ("click",function(){return i.generateChart()}),t._UZ(27,"i",16),t._uU(28," Apply "),t.qZA()()()(),t.YNc(29,F,16,6,"app-card",17),t.qZA()),2&n&&(t.xp6(2),t.Q6J("customHeader",!0),t.xp6(8),t.hij(" ",i.formattedDateTimeRange," "),t.xp6(1),t.Q6J("appHasRoles",t.DdM(7,L)),t.xp6(10),t.Q6J("ngForOf",i.filterData.variableIds),t.xp6(1),t.Q6J("ngForOf",i.filterData.analogVariableIds),t.xp6(1),t.Q6J("ngForOf",i.filterData.ambientVariableIds),t.xp6(6),t.Q6J("ngIf",i.showChart))},dependencies:[f.ez,f.sg,f.O5,y.m,u.YN,u.Kr,u.Fj,u.EJ,u.JJ,u.On,V.A,w.c,v.Ro,b.Qf,b.PZ],styles:[".bi-calendar3{margin-bottom:0}  .btn-apply{padding:2px 8px!important;margin-left:5px}  .custom-card .card{background:linear-gradient(to bottom,rgba(0,190,219,.1490196078),rgba(12,255,0,.1490196078))!important}  .custom-card .card .card-header h5,   .custom-card .card .card-header .h5{font-weight:400;font-size:12px}  .custom-card .input-group.dp .form-control{background:transparent;margin-bottom:5px;padding:0 15px;font-size:14px;line-height:.5;height:25px}  .custom-card .input-group.dp .bi-calendar3.btn{padding-bottom:0!important;padding-top:0!important}  .custom-card select.form-control{background-color:#f5f5f5;line-height:15px}  .custom-card .card .card-header{padding:10px 25px}  .custom-card .card .card-body{padding:10px 25px}  .custom-card .card .card-header .card-header-right .btn.dropdown-toggle{display:none}  .custom-card .form-group label{font-weight:400}  .custom-card .form-control{font-size:14px;line-height:1}  .custom-btn.btn{border-radius:20px;margin:5px!important}  .tag-btn{border-radius:20px;margin-bottom:5px!important;font-size:10px;padding-left:5px;padding-right:5px;margin-right:0!important;margin-top:4px}.card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .card-header-right[_ngcontent-%COMP%]   .btn.dropdown-toggle[_ngcontent-%COMP%]{display:none}.tag-input[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;margin:0}.tag[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff;padding:6px 8px;margin:0 4px;display:flex;align-items:center;border-radius:20px;font-size:10px}.remove[_ngcontent-%COMP%]{cursor:pointer;margin-left:4px;font-weight:700}.disp-flex[_ngcontent-%COMP%]{display:flex}.custom-datetime-range-span[_ngcontent-%COMP%]{padding:2px 8px;border:solid 1px rgb(206,212,218);border-radius:20px}.custom-datetime-range-span[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:15px}"]})}return d})()}}]);